---
title: 'Reducing Crime'
subtitle: 'MIDS W203, Fall 2018, Lab 3'
author: 'Duda Espindola, Pri Nonis, Laura Pintos, Payman Roghani'
output:
    prettydoc::html_pretty:
        theme: architect
        highlight: github
        toc: true
        number_sections: true
---
<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

source('assets/utility.R')

import('prettydoc')
import('knitr')
import('kableExtra')
import('tidyverse')
import('RColorBrewer')
import('ggthemes')
import('stargazer')
import('lmtest')
import('maps')
import('summarytools')
import('formattable')
import('sparkline')
import('cowplot')
import('corrplot')

options(digit=3)
```

# Introduction and Research Question

<center>![Counties of North Carolina](assets/north_carolina.png)</center>

The primary motivation of this report is to provide causal estimates for determinants of crime in the state of North Carolina. The main aim of our study is to shape the public policy platforms, of the political campaign that has hired our services, in the upcoming election cycle. We strive to provide actionable policy recommendations through motivated data analysis of the research question(s).

Our research focuses on the following specific question: <b>Can crime rates be reduced by a tougher criminal justice system?</b> We explore how certainty of punishment and severity of punishment within the criminal justice system affects crime. As one of the key goals of the political campaign is to reduce the crime rate, the natural choice for the outcome variable of our study is the Crime Rate variable. We seek to explain the variability of this variable using Probability of Arrests, Probability of Conviction, and Probability of Prison.

$$
\begin{aligned}
\textbf{Crime Rate} & \sim \textbf{Probability of Arrest} \\
           & + \textbf{Probability of Conviction} \\
           & + \textbf{Probability of Prison}
\end{aligned}
$$

We will primarily use these three explanatory variables as proxies to measure the effects of the the criminal justice system on crime; and this relationship will be explored in our first OLS model. However, we expect other variables to have significant secondary effects on this relationship and will further explore their impact in our extended second OLS model.

## Policy Hypothesis

The null hypothesis assumes that the outcome Crime Rate variable is not impacted by the three explanatory variables Probability of Arrest, Probability of Conviction, and Probability of Prison. We will test the following hypothesis through our detailed data analysis to justify our ultimate policy recommendation(s).

+ <b>Increasing arrest rates will decrease crime rate</b>
<br/>Actionable through more technological and manpower resources allocated to law enforcement
+ <b>Increasing conviction rates will decrease crime rate</b>
<br/>Actionable through stricter sentencing guidelines and more resources allocated to law enforcement agencies to collect higher quality evidence
+ <b>Increasing prison verdicts will decrease crime rate</b>
<br/>Actionable through stricter sentencing guidelines for courts

Our recommendations will be based on sound statistically significant and practically significant results. We hope to reject the null hypothesis by sufficiently explaining the variability of Crime Rate by our explanatory variables. (causal vs associative ..?)

# Data Loading and Cleaning

The primary data source for our study is **Cornwell and W. Trumball (1994), â€œEstimating the Economic Model of Crime with Panel Data, Review of Economics and Statistics 76, 360-366**. We will use a single cross-section of data for **1987** from the multi-year panel. (The authors used panel data methods and instrumental variables to control for some types of omitted variables)

The **Cornwell Dataset** is provided for the year **1987** except for the **Percent Minority** (pctmin), which is provided for 1980. (Talk about additional datasets we used and why here?)

The **Cornwell Dataset** contained several technical defects such as empty (NA) rows, a duplicated row, and a typo that prevented a numeric variable from being loaded correctly.

```{r loading}
crime           <- read.csv('crime_v2.csv')
crime           <- na.omit(crime)
crime           <- crime[!duplicated(crime$county),]
crime$prbconv   <- as.numeric(as.character(crime$prbconv))
rownames(crime) <- NULL
crime.numeric   <- crime[, !names(crime) %in% c('county','year','west','central','urban')]

dim(crime)
```


From the 100 counties of North Carolina our dataset contain a sample of **90** counties; it contains **25** metrics from the following aspects.

+ Identification
  - county, year
+ Crime & Law Enforcement
  - crmrte, prbarr, prbconv, prbpris, avgsen, polpc, mix
+ Demographics & Geography
  - density, west, central, urban
  - pctmin80, taxpc, pctymle
+ Hourly Wages
  - wcon, wfir, wmfg, wser, wtrd, wtuc
  - wfed, wsta, wloc [government]

## Summary of the Variables

```{r summary, echo = FALSE, warning = FALSE, results="asis"}

crime.summary <- tbl_df(t(sapply(1:25, function(n)
                 {
                    x <- crime[,n]
                    c(Variable = colnames(crime)[n],
                      Mean     = round(  mean(x), 1),
                      Median   = round(median(x), 1),
                      SD       = round(    sd(x), 1),
                      Min      = round(   min(x), 1),
                      Max      = round(   max(x), 1),
                      CrimeCOR = round(cor(crime$crmrte,x), 2),
                      Spread   = list(x),
                      Nominal  = list(hist(    x , plot = F)$counts),
                      Log      = list(hist(log(x), plot = F)$counts)
                    )
                 })))


formattable(crime.summary, list(
            CrimeCOR = color_bar("pink"),
            Spread  = function(z)
            {
                sapply(z, function(zz)
                {
                    knitr::knit(text = sprintf("`r sparkline(c(%s), type='box')`",
                                               paste0(zz, collapse = ",")), quiet = TRUE)
                })
            },
            Nominal  = function(z)
            {
                sapply(z, function(zz)
                {
                    knitr::knit(text = sprintf("`r sparkline(c(%s), type='bar')`",
                                               paste0(zz, collapse = ",")), quiet = TRUE)
                })
            },
            Log  = function(z)
            {
                sapply(z, function(zz)
                {
                    knitr::knit(text = sprintf("`r sparkline(c(%s), type='bar')`",
                                               paste0(zz, collapse = ",")), quiet = TRUE)
                })
            }))


```

<br/>Lorem ipsum dolor sit amet, vim eu assum noster verterem. Mei te dolor everti. Amet ferri vel eu. Vel liber postea officiis no.

Eius nusquam ne eum, te sint dicat recusabo pro. Ad solet impetus temporibus pro, delectus lobortis cu eam, mollis voluptua no mei. Cum everti vivendum ea, id eros salutatus sit. Ne his admodum inciderint. Omnes iracundia intellegam eum an. Sit no natum delicata conclusionemque, in quot aliquando similique sed, unum persius ut sea.</br>

<b>DISCUSS IMPORTANT VARIABLE IN MORE DETAIL</b>

## Correlation of the Variables

```{r correlation, fig.align = 'center'}

crime.correlation <- round(cor(crime.numeric, use = 'pairwise.complete.obs'), 2 )
#crime.ptest       <- cor.test(crime.numeric)$p

corrplot(crime.correlation, diag = FALSE, order = 'FPC', type = "upper")
```

* The Population Density is strongly correlated with Crime Rate.
* The Urban Counties are strongly correlated with Crime Rate.


## Analysis of the Outcome Variable

```{r crime, fig.align = 'center', warning = FALSE}
source('assets/maps.R')
map('crmrte', 'Crime Rate per Capita')
```

<br/>Lorem ipsum dolor sit amet, vim eu assum noster verterem. Mei te dolor everti. Amet ferri vel eu. Vel liber postea officiis no.

Eius nusquam ne eum, te sint dicat recusabo pro. Ad solet impetus temporibus pro, delectus lobortis cu eam, mollis voluptua no mei. Cum everti vivendum ea, id eros salutatus sit. Ne his admodum inciderint. Omnes iracundia intellegam eum an. Sit no natum delicata conclusionemque, in quot aliquando similique sed, unum persius ut sea.</br>

```{r transform}
crime$crmrte.log_10k <- log(crime$crmrte) * 10000
```

```{r outcome, fig.align = 'center', warning = FALSE}
pHist <- function(x)
{
    ggplot() + 
        geom_histogram(aes(y=..density..,x=x), bins=20, fill="yellow", colour="black") +
        geom_vline(xintercept=mean(x), linetype="dashed", size=1, colour="blue") +
        stat_function(aes(x=x), fun = dnorm, colour = "red", size = 1,
                      args=list(mean=mean(x), sd=sd(x))) +
        theme_economist()
}

p1 <- pHist(crime$crmrte)
p2 <- pHist(crime$crmrte.log_10k)

plot_grid(p1, p2)
```

<br/>Lorem ipsum dolor sit amet, vim eu assum noster verterem. Mei te dolor everti. Amet ferri vel eu. Vel liber postea officiis no.

Eius nusquam ne eum, te sint dicat recusabo pro. Ad solet impetus temporibus pro, delectus lobortis cu eam, mollis voluptua no mei. Cum everti vivendum ea, id eros salutatus sit. Ne his admodum inciderint. Omnes iracundia intellegam eum an. Sit no natum delicata conclusionemque, in quot aliquando similique sed, unum persius ut sea.</br>

## Correction of Anamolies

We had to address the following anomalies in the dataset.

* The *Probability of Conviction* (prbconv) contains *1* observation(s) that are outside the acceptable range for a probability : [0,1]. We may also consider that this variable is mislabled and is indeed not a probability.

* The *Probability of Arrests* (prbarr) contains *10* observation(s) that are outside the acceptable range for a probability : [0,1].

* The *1000 People per Square Mile* (density) contains an anamolous value of 0.0000203422 for Swain County (FIPS=173). According to the U.S. Census Bureau the 1987 population for this county was 10,932; and the total area is 541 sq. miles. Therefore the correct density was 20.207. Looks like there was an arithmatic error which we can easily resolved : 0.0203422.

We could assume that the data used to calculate these probabalities were inconsistent and possibly not from the same year and or county which has produced this error. Unfortunately this weakens the verasity of these particular variables.

# Model Building Process


The outcome variable of our study is (crmrte) which is coded as 'crimes per person'.


- What do you want to measure? Make sure you identify variables that will be relevant to the concerns of the political campaign.

- What covariates help you identify a causal effect?

- What covariates are problematic, either due to multicollinearity, or because they will absorb some of a causal effect you want to measure?

- What transformations should you apply to each variable? This is very important because transformations can reveal linearities in the data, make our results relevant, or help us meet model assumptions.

- Are your choices supported by EDA?


Higher Crime Rate Seems to Indicate Higher Police. I.E. the police presence was enhanced in crime ridden counties.

# Regression Models

## Base Model

Based on the variables selected, our base population model is:

$$
\begin{aligned}
\textbf{log(Crime Rate)} & \sim \textbf{Probability of Arrest} \\
           & + \textbf{Probability of Conviction} \\
           & + \textbf{Probability of Prison} \\
           & + \textbf{u}
\end{aligned}
$$

```{r base}
model.1 <- with(crime, lm(log(crmrte)~prbarr+prbconv+prbpris))
coefs.1 <- coef(model.1)
```

<b>Model Coefficients</b>

* $\beta_0$ : The **`r names(coefs.1[1])`** is `r round(coefs.1[1],3)`, which can not be interpreted in a meaningful way without considering the other coefficients.
* $\beta_1$ : The **`r names(coefs.1[2])`** coefficient is `r round(coefs.1[2],3)`, which means we could preddict that for every 1% increase in Probability of Arrest that Crime Rate will go down by approximately 1.99%, while holding all other covariates and unobserved factors fixed.
* $\beta_2$ : The **`r names(coefs.1[3])`** coefficient is `r round(coefs.1[3],3)`, which means we could preddict that for every 1% increase in Probability of Conviction that Crime Rate will go down by approximately 0.74%, while holding all other covariates and unobserved factors fixed.
* $\beta_3$ : The **`r names(coefs.1[4])`** coefficient is `r round(coefs.1[4],3)`, which means we could preddict that for every 1% increase in Probability of Prision that Crime Rate will go **up** by approximately 0.34%, while holding all other covariates and unobserved factors fixed.

<b>Goddness of Fit</b>

<b>6 CLM Assumptions</b>

## Second Model

$$
\begin{aligned}
\textbf{log(Crime Rate)} & \sim \textbf{Probability of Arrest} \\
           & + \textbf{Probability of Conviction} \\
           & + \textbf{Probability of Prison} \\
           & + \textbf{u}
\end{aligned}
$$

```{r second}
model.2 <- with(crime, lm(log(crmrte)~prbarr+prbconv+prbpris))
```

## Third Model
## Regression Table

# Ommitted Variables

Possible explanatory variables that are not available :
- Level of education.
- Unemployment.
- Private security.
- Sevirity of crimes; misdemeanours vs felonies.
- Type of crimes; drug offenses vs violent crimes, or white collar crimes vs blue collar crimes etc.

# Conclusion

- Does the conclusion address the high-level concerns of a political campaign?
- Is the discussion connected to whether the key effects are real or whether they may be solely an artifact of omitted variable bias?

